<div class="dashboard-container">
  <header class="dashboard-header">
    <h1>Olá, {{ nomeUsuario }}!</h1>
    <p>Este é o seu plano para atingir o objetivo: <strong>{{ objetivo }}</strong></p>
  </header>

  <main class="dashboard-grid">
    <div class="card calorias-card">
      <h3>Sua Meta Diária</h3>
      <div class="calorias-valor">{{ caloriasMeta }}</div>
      <div class="calorias-label">kcal</div>
      <div class="progresso-wrapper">
        <div class="progress-bar-container">
          <div 
            class="progress-bar" 
            [style.width.%]="calcularPercentual(caloriasConsumidas, caloriasMeta)"
            [ngClass]="getBarraCorClasse()"> </div>
        </div>
        <span class="progresso-texto-calorias">{{ caloriasConsumidas | number:'1.0-0' }} / {{ caloriasMeta }} kcal consumidas</span>
      </div>
    </div>

    <div class="card macros-card">
      <h3>Distribuição de Macros (Metas)</h3>
      <div class="macros-grid">
        <div class="macro-item">
          <div class="macro-header">
            <span class="macro-label">Proteínas</span>
            <span class="macro-valor">{{ proteinasMeta }}g</span>
          </div>
          <div class="macro-progress-wrapper">
            <div class="macro-progress-bar-container">
              <div 
                class="macro-progress-bar macro-progress-proteinas" 
                [style.width.%]="calcularPercentual(proteinasConsumidas, proteinasMeta)">
              </div>
            </div>
            <span class="macro-progress-text">{{ proteinasConsumidas | number:'1.0-0' }}g / {{ proteinasMeta }}g</span>
          </div>
        </div>

        <div class="macro-item">
          <div class="macro-header">
            <span class="macro-label">Carboidratos</span>
            <span class="macro-valor">{{ carboidratosMeta }}g</span>
          </div>
          <div class="macro-progress-wrapper">
            <div class="macro-progress-bar-container">
              <div 
                class="macro-progress-bar macro-progress-carboidratos" 
                [style.width.%]="calcularPercentual(carboidratosConsumidos, carboidratosMeta)">
              </div>
            </div>
            <span class="macro-progress-text">{{ carboidratosConsumidos | number:'1.0-0' }}g / {{ carboidratosMeta }}g</span>
          </div>
        </div>

        <div class="macro-item">
          <div class="macro-header">
            <span class="macro-label">Gorduras</span>
            <span class="macro-valor">{{ gordurasMeta }}g</span>
          </div>
          <div class="macro-progress-wrapper">
            <div class="macro-progress-bar-container">
              <div 
                class="macro-progress-bar macro-progress-gorduras" 
                [style.width.%]="calcularPercentual(gordurasConsumidas, gordurasMeta)">
              </div>
            </div>
            <span class="macro-progress-text">{{ gordurasConsumidas | number:'1.0-0' }}g / {{ gordurasMeta }}g</span>
          </div>
        </div>
      </div>
    </div>

    <div class="card progresso-card">
      <h3>Progresso de Hoje (Macros Consumidos)</h3>
      
      <div *ngIf="hasConsumedData; else noDataPlaceholder">
        <!-- GRÁFICO SEM LEGENDA -->
        <div class="chart-wrapper">
          <ngx-charts-pie-chart
            [results]="dadosDoGrafico"
            [customColors]="colorScheme"
            [doughnut]="true"
            [legend]="false"
            [labels]="true">
          </ngx-charts-pie-chart>
        </div>
        
        <!-- LEGENDA CUSTOMIZADA -->
        <div class="custom-legend">
          <div class="legend-item" *ngFor="let item of dadosDoGrafico">
            <span class="legend-color" [style.background-color]="getCorMacro(item.name)"></span>
            <span class="legend-text">{{ item.name }}: {{ item.value | number:'1.0-0' }}g</span>
          </div>
        </div>
      </div>

      <ng-template #noDataPlaceholder>
        <div class="placeholder-container">
          <p>Registre sua primeira refeição para ver o progresso do seu dia!</p>
        </div>
      </ng-template>
    </div>

<div class="card chat-card">
  <h3>Registre sua Refeição</h3>
  <p>Descreva o que você comeu. Ex: "1 pão francês com 2 ovos mexidos e 1 copo de café com leite".</p>
  
  <div class="chat-window">
    <div *ngFor="let mensagem of mensagensChat" 
         [ngClass]="mensagem.tipo === 'usuario' ? 'user-message' : 'gemini-message'">
      <div class="message-content">{{ mensagem.texto }}</div>
      <div class="message-time">{{ mensagem.timestamp | date:'HH:mm' }}</div>
    </div>
    
    <div *ngIf="aguardandoResposta" class="gemini-message typing-indicator">
      <div class="message-content">
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
      </div>
    </div>
  </div>
  
  <form class="chat-input-form" (submit)="enviarMensagemChat($event)">
    <input 
      type="text" 
      name="chatInput" 
      placeholder="Digite sua refeição aqui..." 
      autocomplete="off"
      [disabled]="aguardandoResposta">
    <button type="submit" [disabled]="aguardandoResposta">
      {{ aguardandoResposta ? 'Enviando...' : 'Enviar' }}
    </button>
  </form>
</div>
  </main>
</div>