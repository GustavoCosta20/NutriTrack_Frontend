<div class="history-container">
  <header class="history-header">
    <h2>Hist√≥rico de Refei√ß√µes</h2>
    <p>Acompanhe seu progresso nas √∫ltimas semanas.</p>
  </header>

  <!-- Loading State -->
  <div *ngIf="carregando" class="loading-state">
    <p>Carregando hist√≥rico...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="erro && !carregando" class="error-state">
    <p>{{ erro }}</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!carregando && !erro && historico.length === 0" class="empty-state">
    <p>Nenhuma refei√ß√£o registrada ainda.</p>
    <p>Comece adicionando sua primeira refei√ß√£o!</p>
  </div>

  <!-- Accordion com dados -->
  <div class="accordion" *ngIf="!carregando && !erro && historico.length > 0">
    <div *ngFor="let dia of historico; let i = index" class="accordion-item">

      <div class="accordion-header" (click)="toggleDia(i)">
        <span class="header-date">
          {{ dia.data | date:'fullDate':'':'pt-BR' }}
          <strong *ngIf="dia.isHoje">(Hoje)</strong>
        </span>
        <span class="header-summary">
          Total: <strong>{{ dia.totalCaloriasDia | number:'1.0-0' }} kcal</strong>
          <span class="caret" [class.open]="diaExpandido === i"></span>
        </span>
      </div>

      <div class="accordion-content" *ngIf="diaExpandido === i">
        <div *ngFor="let refeicao of dia.refeicoes" class="meal-card">
          <div class="meal-header">
            <h4>{{ refeicao.nome }} - {{ refeicao.totalCalorias | number:'1.0-0' }} kcal</h4>
            <div class="meal-actions">
              <button 
                class="btn-icon btn-edit" 
                (click)="abrirModalEditar(refeicao.id, refeicao.nome)"
                title="Editar refei√ß√£o">
                ‚úèÔ∏è
              </button>
              <button 
                class="btn-icon btn-delete" 
                (click)="abrirModalExcluir(refeicao.id, refeicao.nome)"
                title="Excluir refei√ß√£o">
                üóëÔ∏è
              </button>
            </div>
          </div>
          <ul>
            <li *ngFor="let alimento of refeicao.alimentos">
              <span>{{ alimento.descricao }}</span>
              <span>{{ alimento.calorias | number:'1.0-0' }} kcal</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Exclus√£o -->
<div class="modal-overlay" *ngIf="modalExcluirAberto" (click)="fecharModalExcluir()">
  <div class="modal-content-wrapper" (click)="$event.stopPropagation()">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Confirmar Exclus√£o</h3>
        <button class="btn-close" (click)="fecharModalExcluir()" [disabled]="excluindo">√ó</button>
      </div>
      <div class="modal-body">
        <p>Tem certeza que deseja excluir a refei√ß√£o <strong>{{ refeicaoParaExcluir?.nome }}</strong>?</p>
        <p class="warning-text">Esta a√ß√£o n√£o pode ser desfeita.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="fecharModalExcluir()" [disabled]="excluindo">
          Cancelar
        </button>
        <button class="btn btn-danger" (click)="confirmarExclusao()" [disabled]="excluindo">
          {{ excluindo ? 'Excluindo...' : 'Excluir' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Edi√ß√£o -->
<div class="modal-overlay" *ngIf="modalEditarAberto" (click)="fecharModalEditar()">
  <div class="modal-content-wrapper modal-edit" (click)="$event.stopPropagation()">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Editar Refei√ß√£o</h3>
        <button class="btn-close" (click)="fecharModalEditar()" [disabled]="editando">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="nomeEdicao">Nome da Refei√ß√£o</label>
          <input 
            type="text" 
            id="nomeEdicao"
            class="form-control"
            [(ngModel)]="nomeEdicao"
            placeholder="Ex: Caf√© da manh√£"
            [disabled]="editando">
        </div>
        <div *ngIf="erroEdicao" class="alert alert-error">
          {{ erroEdicao }}
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="fecharModalEditar()" [disabled]="editando">
          Cancelar
        </button>
        <button class="btn btn-primary" (click)="confirmarEdicao()" [disabled]="editando">
          {{ editando ? 'Salvando...' : 'Salvar Altera√ß√µes' }}
        </button>
      </div>
    </div>
  </div>
</div>